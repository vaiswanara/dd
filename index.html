<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>VAMSHA VRUKSHA</title>
    <link rel="manifest" href="manifest.json">
    <meta name="theme-color" content="#4A90E2">
    <link rel="apple-touch-icon" href="app_icons/icon-512.png">
    <link rel="icon" href="app_icons/icon-512.png" type="image/png">
    <style>
        /* --- CSS Variables & Reset --- */
        :root { --sidebar-width: 260px; --header-height: 60px; --primary-color: #4A90E2; --text-dark: #333; --bg-light: #f4f7f6; }
        body { margin: 0; font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; overflow: hidden; display: flex; height: 100vh; height: 100dvh; background: var(--bg-light); }
        * { box-sizing: border-box; }

        /* --- Sidebar (Slide Bar) --- */
        #sidebar { width: var(--sidebar-width); background: #fff; border-right: 1px solid #e0e0e0; display: flex; flex-direction: column; z-index: 1000; transition: transform 0.3s ease; flex-shrink: 0; }
        .brand { padding: 25px 20px; text-align: center; border-bottom: 1px solid #eee; }
        .brand img { width: 80px; height: auto; margin-bottom: 15px; display: block; margin-left: auto; margin-right: auto; }
        .brand h1 { margin: 0; font-size: 22px; color: var(--text-dark); letter-spacing: 1px; }
        .brand h2 { margin: 8px 0 0; font-size: 13px; color: #777; font-weight: normal; text-transform: uppercase; letter-spacing: 0.5px; }
        
        .menu { list-style: none; padding: 20px 0; margin: 0; flex: 1; overflow-y: auto; }
        .menu li a { display: block; padding: 15px 25px; color: #555; text-decoration: none; font-weight: 500; transition: all 0.2s; border-left: 4px solid transparent; }
        .menu li a:hover, .menu li a.active { background: #eef5fc; color: var(--primary-color); border-left-color: var(--primary-color); }
        
        /* --- Main Content Area --- */
        #main { flex: 1; display: flex; flex-direction: column; position: relative; width: 100%; overflow: hidden; }
        
        /* Header */
        header { height: var(--header-height); background: #fff; border-bottom: 1px solid #e0e0e0; display: flex; align-items: center; padding: 0 20px; justify-content: space-between; flex-shrink: 0; }
        .toggle-btn { font-size: 24px; cursor: pointer; display: none; margin-right: 15px; color: #555; }
        
        /* Search Bar */
        .search-wrapper { flex: 1; max-width: 500px; display: flex; align-items: center; position: relative; }
        #search-input { width: 100%; padding: 10px 20px; border: 1px solid #ddd; border-radius: 25px; outline: none; font-size: 16px; transition: border 0.3s; background: #f9f9f9; }
        #search-input:focus { border-color: var(--primary-color); background: #fff; }
        #search-suggestions { position: absolute; top: 100%; left: 0; right: 0; background: #fff; border: 1px solid #ddd; border-radius: 8px; max-height: 300px; overflow-y: auto; z-index: 2000; display: none; box-shadow: 0 4px 12px rgba(0,0,0,0.1); margin-top: 5px; }
        .suggestion-item { padding: 12px 20px; cursor: pointer; border-bottom: 1px solid #f0f0f0; font-size: 14px; }
        .suggestion-item:hover { background-color: #f5f5f5; color: var(--primary-color); }

        /* Tree Container */
        #tree { flex: 1; width: 100%; height: 100%; background-color: #fff; position: relative; touch-action: none; }

        /* --- Modal Styles --- */
        #person-modal-overlay { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.5); z-index: 3000; justify-content: center; align-items: center; backdrop-filter: blur(2px); }
        #person-modal-overlay.show { display: flex; }
        #person-modal { background: #fff; width: 95%; max-width: 480px; max-height: 90vh; border-radius: 12px; display: flex; flex-direction: column; overflow: hidden; box-shadow: 0 15px 35px rgba(0,0,0,0.2); animation: slideUp 0.3s ease; }
        @keyframes slideUp { from { transform: translateY(20px); opacity: 0; } to { transform: translateY(0); opacity: 1; } }
        
        .modal-header { padding: 15px 20px; border-bottom: 1px solid #eee; display: flex; justify-content: space-between; align-items: center; background: #fff; }
        .modal-header h3 { margin: 0; font-size: 18px; color: var(--text-dark); }
        .modal-close { background: none; border: none; font-size: 24px; cursor: pointer; color: #999; }
        
        .modal-scroll-content { overflow-y: auto; flex: 1; padding: 0; }
        .avatar-section { padding: 20px; text-align: center; background: linear-gradient(to bottom, #f9f9f9, #fff); }
        #person-modal-avatar { width: 100px; height: 100px; border-radius: 50%; object-fit: cover; border: 3px solid #fff; box-shadow: 0 4px 10px rgba(0,0,0,0.1); display: none; margin: 0 auto; }
        #person-modal-avatar-fallback { width: 100px; height: 100px; border-radius: 50%; background: #e0e0e0; color: #757575; font-size: 36px; display: flex; justify-content: center; align-items: center; margin: 0 auto; font-weight: bold; }
        #person-modal-id { margin-top: 10px; font-size: 12px; color: #888; font-family: monospace; }
        
        .details-table { width: 100%; border-collapse: collapse; margin-top: 0; }
        .details-table tr { border-bottom: 1px solid #f5f5f5; }
        .details-table th, .details-table td { padding: 12px 20px; font-size: 14px; }
        
        .modal-footer { padding: 15px 20px; border-top: 1px solid #eee; display: flex; justify-content: flex-end; gap: 10px; background: #f9f9f9; }
        .btn { padding: 8px 16px; border-radius: 6px; border: none; cursor: pointer; font-size: 13px; font-weight: 500; }
        .btn-primary { background: var(--primary-color); color: white; }
        .btn-outline { background: transparent; border: 1px solid #ccc; color: #555; }

        /* --- Birthdays Page --- */
        #birthdays-page { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: #fff; z-index: 5000; flex-direction: column; overflow-y: auto; animation: fadeIn 0.3s ease; }
        .birthdays-header { padding: 15px 20px; border-bottom: 1px solid #eee; display: flex; align-items: center; gap: 15px; background: #fff; position: sticky; top: 0; z-index: 1; }
        .birthdays-back { font-size: 24px; cursor: pointer; background: none; border: none; padding: 0; color: #333; }
        .birthdays-content { padding: 20px; max-width: 600px; margin: 0 auto; width: 100%; }
        .birthday-date-block { margin-bottom: 24px; padding-bottom: 16px; border-bottom: 1px solid #eee; }
        .birthday-date-line { font-size: 15px; color: #4A90E2; font-weight: 700; margin-bottom: 6px; letter-spacing: 0.5px; }
        .birthday-person-block { margin-bottom: 12px; }
        .birthday-name { font-size: 16px; color: #333; font-weight: 600; margin-bottom: 0; }
        .birthday-name a { color: #039BE5; text-decoration: none; }
        .birthday-name a:hover { text-decoration: underline; }
        .birthday-phone { font-size: 16px; margin-top: 6px; margin-bottom: 4px; margin-left: 0; }
        .birthday-whatsapp-link { color: #25D366; text-decoration: none; font-weight: 500; }
        .birthday-whatsapp-link:hover { text-decoration: underline; }

        /* --- Help Page --- */
        #help-page { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: #fff; z-index: 5000; flex-direction: column; overflow-y: auto; animation: fadeIn 0.3s ease; }
        .help-header { padding: 15px 20px; border-bottom: 1px solid #eee; display: flex; align-items: center; gap: 15px; background: #fff; position: sticky; top: 0; z-index: 1; }
        .help-back { font-size: 24px; cursor: pointer; background: none; border: none; padding: 0; color: #333; }
        .help-content { padding: 20px; max-width: 600px; margin: 0 auto; width: 100%; }
        .help-section { margin-bottom: 20px; border-bottom: 1px solid #f0f0f0; padding-bottom: 15px; }
        .help-section:last-child { border-bottom: none; }
        .help-section h3 { color: var(--primary-color); font-size: 16px; margin: 0 0 8px; display: flex; align-items: center; gap: 8px; }
        .help-section p { margin: 0 0 5px; color: #444; font-size: 14px; line-height: 1.5; }
        .help-section strong { color: #333; }

        /* --- Install App Page --- */
        #install-page { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: #fff; z-index: 5000; flex-direction: column; overflow-y: auto; animation: fadeIn 0.3s ease; }
        .install-header { padding: 15px 20px; border-bottom: 1px solid #eee; display: flex; align-items: center; gap: 15px; background: #fff; position: sticky; top: 0; z-index: 1; }
        .install-back { font-size: 24px; cursor: pointer; background: none; border: none; padding: 0; color: #333; }
        .install-content { padding: 20px; max-width: 600px; margin: 0 auto; width: 100%; }
        .install-card { background: #fff; border: 1px solid #eee; border-radius: 16px; padding: 18px; box-shadow: 0 6px 20px rgba(0,0,0,0.05); }
        .install-hero { display: flex; gap: 16px; align-items: center; }
        .install-hero img { width: 72px; height: 72px; border-radius: 18px; object-fit: cover; box-shadow: 0 4px 12px rgba(0,0,0,0.12); border: 1px solid rgba(0,0,0,0.06); }
        .install-hero h2 { margin: 0; font-size: 18px; color: #333; }
        .install-hero p { margin: 6px 0 0; color: #666; font-size: 14px; line-height: 1.5; }
        .install-actions { margin-top: 16px; display: flex; flex-wrap: wrap; gap: 10px; }
        .install-btn { background: var(--primary-color); color: #fff; border: none; border-radius: 999px; padding: 12px 18px; font-size: 15px; font-weight: 700; cursor: pointer; box-shadow: 0 10px 22px rgba(74, 144, 226, 0.32); display: inline-flex; align-items: center; gap: 10px; }
        .install-btn:disabled { opacity: 0.55; cursor: not-allowed; box-shadow: none; }
        .install-hint { margin-top: 12px; color: #666; font-size: 13px; line-height: 1.6; }
        .install-hint code { background: #f6f7f9; border: 1px solid #eceff3; padding: 2px 6px; border-radius: 6px; }

        /* --- Sidebar backdrop (mobile: tap outside to close) --- */
        #sidebar-backdrop { display: none; position: fixed; inset: 0; background: rgba(0,0,0,0.35); z-index: 999; }
        #sidebar-backdrop.show { display: block; }

        /* --- Responsive Logic --- */
        @media (min-width: 769px) {
            #sidebar-backdrop.show { display: none; }
        }
        @media (max-width: 768px) {
            #sidebar { position: fixed; height: 100%; transform: translateX(-100%); box-shadow: 2px 0 10px rgba(0,0,0,0.1); }
            #sidebar.open { transform: translateX(0); }
            #sidebar-backdrop.show { display: block; }
            .toggle-btn { display: block; }
            #main { width: 100%; }
            header { padding: 0 10px; }
        }

        /* --- Dashboard Styles --- */
        #dashboard-page { display: none; flex: 1; padding: 20px; overflow-y: auto; background: #f4f7f6; animation: fadeIn 0.3s ease; }
        .dash-welcome { background: #fff; padding: 15px 20px; border-radius: 12px; box-shadow: 0 2px 10px rgba(0,0,0,0.05); display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px; flex-wrap: wrap; gap: 10px; }
        .dash-welcome h2 { margin: 0; font-size: 18px; color: #333; }
        .dash-date { color: #888; font-size: 14px; font-weight: 500; }
        
        .namaste-card { background: linear-gradient(135deg, #1e3c72 0%, #2a5298 100%); color: white; padding: 15px 20px; border-radius: 12px; text-align: center; margin-bottom: 15px; box-shadow: 0 4px 10px rgba(30, 60, 114, 0.3); position: relative; overflow: hidden; }
        .namaste-card { background: linear-gradient(135deg, #FF9966 0%, #FF5E62 100%); color: white; padding: 15px 20px; border-radius: 12px; text-align: center; margin-bottom: 15px; box-shadow: 0 4px 10px rgba(255, 94, 98, 0.3); position: relative; overflow: hidden; }
        .namaste-card h1 { margin: 0; font-size: 24px; letter-spacing: 1px; }
        .namaste-card p { margin: 0; opacity: 0.95; font-size: 16px; font-weight: 500; }
        .dash-message-card { display: none; background: #fff; padding: 15px 20px; border-radius: 12px; box-shadow: 0 2px 10px rgba(0,0,0,0.05); margin-bottom: 20px; color: #E91E63; font-weight: 600; font-size: 15px; border-left: 5px solid #E91E63; animation: fadeIn 0.3s ease; line-height: 1.5; }
        
        .open-tree-card { background: #fff; border-radius: 16px; padding: 0; margin-bottom: 20px; cursor: pointer; transition: transform 0.2s; box-shadow: 0 4px 15px rgba(0,0,0,0.05); overflow: hidden; position: relative; height: 180px; display: flex; align-items: center; justify-content: center; border: 2px solid transparent; }
        .open-tree-card:hover { border-color: var(--primary-color); }
        .open-tree-card:active { transform: scale(0.98); }
        /* Placeholder tree illustration using CSS/SVG background */
        .open-tree-bg { position: absolute; top: 0; left: 0; width: 100%; height: 100%; opacity: 0.2; background-image: url('app_icons/ftree.jpg'); background-repeat: no-repeat; background-position: center; background-size: cover; }
        .open-tree-content { position: relative; z-index: 2; text-align: center; }
        .open-tree-btn { background: var(--primary-color); color: white; padding: 12px 30px; border-radius: 30px; font-weight: bold; font-size: 16px; border: none; box-shadow: 0 4px 10px rgba(74, 144, 226, 0.4); pointer-events: none; }
        
        .stats-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(100px, 1fr)); gap: 15px; }
        .stat-card { background: #fff; padding: 20px 15px; border-radius: 12px; text-align: center; box-shadow: 0 2px 10px rgba(0,0,0,0.05); cursor: pointer; transition: transform 0.2s; display: flex; flex-direction: column; justify-content: center; align-items: center; height: 130px; }
        .stat-card:active { transform: scale(0.98); }
        .stat-icon { font-size: 28px; margin-bottom: 10px; }
        .stat-value { font-size: 22px; font-weight: bold; color: #333; margin-bottom: 5px; }
        .stat-label { font-size: 12px; color: #777; font-weight: 500; text-transform: uppercase; }

        /* Utility to hide tree */
        .hidden { display: none !important; }

        /* --- User Identity Card --- */
        .user-identity-card { background: #fff; padding: 15px 20px; border-radius: 12px; box-shadow: 0 2px 10px rgba(0,0,0,0.05); margin-bottom: 20px; animation: fadeIn 0.3s ease; }
        .user-identity-content { display: flex; justify-content: space-between; align-items: center; }
        .user-identity-info { display: flex; flex-direction: column; }
        .user-identity-label { font-size: 12px; color: #888; margin-bottom: 4px; }
        .user-identity-name { font-size: 16px; font-weight: bold; color: var(--primary-color); }
        .user-change-btn { background: transparent; border: 1px solid #ccc; color: #666; padding: 6px 14px; border-radius: 20px; font-size: 12px; cursor: pointer; font-weight: 500; transition: all 0.2s; }
        .user-change-btn:hover { border-color: var(--primary-color); color: var(--primary-color); background: #f0f7ff; }

        /* --- Generic App Toast --- */
        .app-toast { position: fixed; bottom: 30px; left: 50%; transform: translateX(-50%); background: rgba(50, 50, 50, 0.95); color: #fff; padding: 14px 24px; border-radius: 50px; box-shadow: 0 6px 20px rgba(0,0,0,0.25); z-index: 6000; opacity: 0; pointer-events: none; transition: opacity 0.3s ease, transform 0.3s ease; font-size: 14px; font-weight: 500; text-align: center; max-width: 90%; width: max-content; backdrop-filter: blur(4px); border: 1px solid rgba(255,255,255,0.1); }
        .app-toast.show { opacity: 1; transform: translateX(-50%) translateY(-10px); }

        /* --- Lineage Path Bar --- */
        #lineage-bar { display: none; align-items: center; gap: 8px; padding: 10px 15px; background: #f8f9fa; border-top: 1px solid #e0e0e0; overflow-x: auto; white-space: nowrap; -webkit-overflow-scrolling: touch; scrollbar-width: none; flex-shrink: 0; }
        #lineage-bar::-webkit-scrollbar { display: none; }
        .lineage-item { font-size: 13px; color: #555; cursor: pointer; padding: 4px 12px; border-radius: 15px; background: #fff; border: 1px solid #ddd; flex-shrink: 0; transition: all 0.2s; font-weight: 500; }
        .lineage-item:hover { border-color: var(--primary-color); color: var(--primary-color); background: #f0f7ff; }
        .lineage-item.current { font-weight: bold; background: var(--primary-color); color: #fff; border-color: var(--primary-color); box-shadow: 0 2px 5px rgba(74, 144, 226, 0.3); }
        .lineage-arrow { color: #bbb; font-size: 12px; flex-shrink: 0; }

        /* --- Form Page --- */
        #form-page { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: #fff; z-index: 5000; flex-direction: column; animation: fadeIn 0.3s ease; }
        .form-header { padding: 15px 20px; border-bottom: 1px solid #eee; display: flex; align-items: center; gap: 15px; background: #fff; flex-shrink: 0; }
        .form-back { font-size: 24px; cursor: pointer; background: none; border: none; padding: 0; color: #333; }
        .form-content { flex: 1; width: 100%; height: 100%; display: flex; flex-direction: column; background: #f0f0f0; }
        .form-iframe { width: 100%; flex: 1; border: none; display: block; background: #fff; }
        .form-fallback { padding: 10px; text-align: center; background: #fff; border-bottom: 1px solid #eee; font-size: 13px; color: #666; }
        .form-fallback a { color: var(--primary-color); text-decoration: none; font-weight: bold; }
    </style>
</head>
<body>
    <!-- Sidebar Navigation -->
    <nav id="sidebar">
        <div class="brand">
            <img src="app_icons/logo.png" alt="DFWA Logo">
            <h1>VAMSHA VRUKSHA</h1>
            <h2>Powerd by DFWA</h2>
        </div>
        <ul class="menu" id="sidebar-menu">
            <li><a href="#" id="nav-dashboard" class="active" onclick="window.showDashboard(); closeSidebar();">üè† Dashboard</a></li>
            <li><a href="#" id="nav-tree" onclick="window.showTreePage(); closeSidebar();">üå≥ FAMILY TREE</a></li>
            <li><a href="#" onclick="showNews(); closeSidebar();">üì∞ UPDATES</a></li>
            <li><a href="#" onclick="showBirthdays(); closeSidebar();">üéÇ BIRTHDAYs</a></li>
            <li><a href="#" onclick="showFormPage(); closeSidebar();">üìù UPDATE DATA</a></li>
            <li><a href="#" onclick="showHelp(); closeSidebar();">‚ùì HELP</a></li>
            <li><a href="#" id="nav-install" onclick="window.showInstallPage(); closeSidebar();">‚¨áÔ∏è Install App</a></li>
            <li><a href="#" onclick="alert('About Dharmavaram Dynasty:\n\nA comprehensive genealogy record.'); closeSidebar();">‚ÑπÔ∏è ABOUT</a></li>
            <li><a href="#" onclick="alert('Please send feedback to admin.'); closeSidebar();">üí¨ FEEDBACK</a></li>
        </ul>
    </nav>

    <!-- Backdrop: tap/click outside sidebar to close it (mobile) -->
    <div id="sidebar-backdrop" aria-hidden="true"></div>

    <!-- Main Content -->
    <div id="main">
        <header>
            <div style="display: flex; align-items: center;">
                <span class="toggle-btn" onclick="toggleSidebar()">&#9776;</span>
            </div>
            <div class="search-wrapper">
                <!-- Home button is injected here by app.js -->
                <input type="text" id="search-input" placeholder="Search family member...">
                <div id="search-suggestions"></div>
            </div>
        </header>

        <!-- Dashboard Page -->
        <div id="dashboard-page">
            <!-- 1. Namaste Card (Moved to Top) -->
            <div class="namaste-card">
                <h1>üôè Namaste!</h1>
            </div>

            <!-- 2. Welcome Header -->
            <div class="dash-welcome" style="justify-content: center;">
                <div style="text-align: center;">
                    <h2>Welcome to Vamsha Vruksha</h2>
                    <p style="font-size: 14px; color: #888; margin: 4px 0 0;">Powered by DFWA</p>
                </div>
                <div class="dash-date" id="dash-date" style="display: none;"></div>
            </div>

            <!-- 2.5 Dynamic Message Section -->
            <div id="dash-dynamic-msg" class="dash-message-card"></div>

            <!-- 3. User Identity Section (New Box) -->
            <div id="dash-user-row" class="user-identity-card" style="display:none;">
                <div class="user-identity-content">
                    <div class="user-identity-info">
                        <span class="user-identity-label">Home Person</span>
                        <span id="dash-home-name" class="user-identity-name"></span>
                    </div>
                    <button onclick="window.changeHomePerson()" class="user-change-btn">Change</button>
                </div>
            </div>

            <!-- Open Tree Card -->
            <div class="open-tree-card" onclick="window.showTreePage()">
                <div class="open-tree-bg"></div>
                <div class="open-tree-content">
                    <button class="open-tree-btn">Open Family Tree</button>
                </div>
            </div>

            <!-- Family Info Section -->
            <div class="stats-grid">
                <div class="stat-card" onclick="window.showTreePage()">
                    <div class="stat-icon">üë•</div>
                    <div class="stat-value" id="stat-total-members">-</div>
                    <div class="stat-label">Total Members</div>
                </div>
                <div class="stat-card" onclick="window.showBirthdays()">
                    <div class="stat-icon">üéÇ</div>
                    <div class="stat-value" id="stat-upcoming-birthdays">-</div>
                    <div class="stat-label">Upcoming Birthdays</div>
                </div>
                <div class="stat-card" onclick="window.focusSearch()">
                    <div class="stat-icon">üîç</div>
                    <div class="stat-value">Find</div>
                    <div class="stat-label">Search Member</div>
                </div>
                <div class="stat-card" onclick="window.showFormPage()">
                    <div class="stat-icon">üìù</div>
                    <div class="stat-value">Add</div>
                    <div class="stat-label">Update Data</div>
                </div>
            </div>
        </div>

        <div id="tree"></div>

        <!-- Lineage Path Bar -->
        <div id="lineage-bar"></div>
    </div>

    <!-- Person Details Modal -->
    <div id="person-modal-overlay" aria-hidden="true">
        <div id="person-modal">
            <div class="modal-header">
                <h3 id="person-modal-name">Name</h3>
                <button id="person-modal-close" class="modal-close">&times;</button>
            </div>
            <div class="modal-scroll-content">
                <div class="avatar-section">
                    <img id="person-modal-avatar" src="" alt="Profile">
                    <div id="person-modal-avatar-fallback"></div>
                    <div id="person-modal-id"></div>
                </div>
                <table class="details-table">
                    <tbody id="person-modal-body">
                        <!-- Rows injected by app.js -->
                    </tbody>
                </table>
            </div>
            <div class="modal-footer">
                <button id="person-home-btn" class="btn btn-outline">Set as Home</button>
                <button id="relation-btn" class="btn btn-primary">Relationship</button>
                <button id="person-share-btn" class="btn btn-primary">Share Profile</button>
            </div>
        </div>
    </div>

    <!-- Relationship Details Modal -->
    <div id="relationship-modal-overlay" aria-hidden="true" style="display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.5); z-index: 3000; justify-content: center; align-items: center; backdrop-filter: blur(2px);">
        <div id="relationship-modal" style="background: #fff; width: 90%; max-width: 400px; border-radius: 12px; box-shadow: 0 15px 35px rgba(0,0,0,0.2); animation: slideUp 0.3s ease;">
            <div class="modal-header">
                <h3 style="margin: 0; font-size: 18px;">Relationship</h3>
                <button id="relationship-modal-close" class="modal-close">&times;</button>
            </div>
            <div id="relationship-modal-body" style="padding: 20px 25px; line-height: 1.6; text-align: center;">
                <!-- Content injected by app.js -->
            </div>
        </div>
    </div>

    <!-- News Modal -->
    <div id="news-modal-overlay" aria-hidden="true" style="display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.5); z-index: 3000; justify-content: center; align-items: center; backdrop-filter: blur(2px);">
        <div style="background: #fff; width: 90%; max-width: 400px; border-radius: 12px; padding: 20px; box-shadow: 0 15px 35px rgba(0,0,0,0.2); animation: slideUp 0.3s ease;">
            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px; border-bottom: 1px solid #eee; padding-bottom: 10px;">
                <h3 style="margin: 0; color: var(--primary-color); font-size: 18px;">üì¢ Latest News</h3>
                <button onclick="document.getElementById('news-modal-overlay').style.display='none'" style="background: none; border: none; font-size: 24px; cursor: pointer; color: #999;">&times;</button>
            </div>
            <div id="news-content" style="max-height: 60vh; overflow-y: auto;"></div>
        </div>
    </div>

    <!-- Generic App Toast -->
    <div id="app-toast" class="app-toast"></div>

    <!-- Birthdays Page (next 20 days) -->
    <div id="birthdays-page">
        <div class="birthdays-header">
            <button id="birthdays-page-close" class="birthdays-back">&larr;</button>
            <h3 style="margin:0; font-size: 18px;">Upcoming Birthdays</h3>
        </div>
        <div id="birthdays-content" class="birthdays-content">
            <!-- Content injected by app.js -->
        </div>
    </div>

    <!-- Form Page -->
    <div id="form-page">
        <div class="form-header">
            <button id="form-page-close" class="form-back">&larr;</button>
            <h3 style="margin:0; font-size: 18px;">Submit Family Data</h3>
        </div>
        <div class="form-content" style="background: #fff; display: block; overflow-y: auto;">
            <div style="text-align: center; padding: 30px 20px 10px;">
                <p style="color: #666; margin: 0 0 15px; font-size: 15px;">Ready to add your family details?</p>
                <a href="https://docs.google.com/forms/d/e/1FAIpQLSfXN90TgDOzXB3QfTte13QTdYXIpISceFku-sOdr9gTYspV3A/viewform" target="_blank" style="text-decoration: none;">
                    <button style="background: var(--primary-color); color: white; padding: 15px 30px; border: none; border-radius: 30px; font-size: 16px; font-weight: bold; cursor: pointer; box-shadow: 0 4px 15px rgba(74, 144, 226, 0.4); display: inline-flex; align-items: center; gap: 10px;">
                        Open Google Form üìù
                    </button>
                </a>
            </div>

            <div style="padding: 20px 25px 40px; max-width: 600px; margin: 0 auto; color: #333; line-height: 1.6;">
                <h2 style="color: var(--primary-color); font-size: 20px; margin-top: 0; margin-bottom: 15px; border-bottom: 1px solid #eee; padding-bottom: 10px;">Contribute to Vamsha Vruksha</h2>
                
                <p style="margin-bottom: 15px;">Namaste! We are maintaining this family tree to preserve our rich history and connect with our roots. Your contribution helps us keep this record accurate and complete for future generations.</p>

                <h3 style="font-size: 16px; color: #444; margin: 20px 0 10px;">Who can you add?</h3>
                <p style="margin-bottom: 10px;">You may fill out this form to add or correct details for:</p>
                <ul style="padding-left: 20px; color: #555; margin-bottom: 15px;">
                    <li>Yourself</li>
                    <li>Your children</li>
                    <li>Your parents</li>
                    <li>Any other relatives</li>
                </ul>

                <h3 style="font-size: 16px; color: #444; margin: 20px 0 10px;">Important Notes</h3>
                <ul style="padding-left: 20px; color: #555; margin-bottom: 15px;">
                    <li style="margin-bottom: 8px;"><strong>Partial info is okay:</strong> It is fine if you do not know every detail.</li>
                    <li style="margin-bottom: 8px;"><strong>Dates:</strong> Approximate years (e.g., "1985") are acceptable if exact dates are unknown.</li>
                    <li style="margin-bottom: 8px;"><strong>Manual Update:</strong> This website does not update instantly. All entries are personally reviewed before being added.</li>
                </ul>

                <h3 style="font-size: 16px; color: #444; margin: 20px 0 10px;">Photographs</h3>
                <p style="margin-bottom: 15px;">Photos bring the tree to life! If you have a face photo, please attach it. Old photographs are also very welcome. This is optional.</p>

                <div style="background: #f9f9f9; padding: 15px; border-radius: 8px; margin: 20px 0; font-size: 14px; border-left: 4px solid #ccc;">
                    <strong>Note on Google Sign-in:</strong><br>
                    To securely attach a photo, Google may ask you to sign in. Please be assured that we never see your password or personal account details.
                </div>

                <h3 style="font-size: 16px; color: #444; margin: 20px 0 10px;">Before you begin</h3>
                <ul style="padding-left: 20px; color: #555; margin-bottom: 25px;">
                    <li>Keep names and dates ready.</li>
                    <li>Have photos ready on your device if you wish to upload them.</li>
                </ul>

                <hr style="border: 0; border-top: 1px solid #eee; margin-bottom: 20px;">
                
                <p style="text-align: center; font-weight: 500; color: var(--primary-color); font-style: italic;">Thank you for helping us preserve our heritage. Your time and effort are deeply appreciated.</p>
            </div>
        </div>
    </div>

    <!-- Help Page -->
    <div id="help-page">
        <div class="help-header">
            <button id="help-page-close" class="help-back">&larr;</button>
            <h3 style="margin:0; font-size: 18px;">Help & Guide</h3>
        </div>
        <div class="help-content">
            <div style="text-align: center; margin-bottom: 25px;">
                <img src="app_icons/logo.png" alt="App Logo" style="width: 80px; height: 80px; border-radius: 16px; margin-bottom: 10px; box-shadow: 0 4px 12px rgba(0,0,0,0.1);">
                <h2 style="margin: 0; color: #333; font-size: 20px;">Vamsha Vruksha</h2>
                <p style="color: #777; font-size: 13px;">User Guide</p>
            </div>

            <div class="help-section">
                <h3>üîç Search Bar</h3>
                <p>Type a name in the top search bar. Tap on a name from the suggestions to view that person in the tree.</p>
            </div>

            <div class="help-section">
                <h3>üë§ Person Details</h3>
                <p>Tap on any person in the tree to center them.</p>
                <p>Click the <strong>Profile Icon (üë§)</strong> next to the search bar to view full details (Parents, Spouse, Children, etc.).</p>
                <p><em>Tip: You can also long-press a person on the tree to view details.</em></p>
            </div>

            <div class="help-section">
                <h3>üè† Set Home Person</h3>
                <p>Go to your own profile details.</p>
                <p>Click the <strong>"Set as Home"</strong> button.</p>
                <p>Now, the <strong>Home Button (üè†)</strong> at the top will always bring the tree back to you.</p>
            </div>

            <div class="help-section">
                <h3>‚ÜîÔ∏è Relationships</h3>
                <p>Select any person in the tree.</p>
                <p>Click the <strong>Relationship Icon (‚ÜîÔ∏è)</strong> at the top.</p>
                <p>It will show how the selected person is related to the Home Person (You).</p>
            </div>

            <div class="help-section">
                <h3>üéÇ Birthdays & Updates</h3>
                <p>Check the Sidebar Menu (‚ò∞) for <strong>Birthdays</strong> (next 20 days) and latest <strong>Updates</strong>.</p>
            </div>
        </div>
    </div>

    <!-- Install App Page -->
    <div id="install-page">
        <div class="install-header">
            <button id="install-page-close" class="install-back">&larr;</button>
            <h3 style="margin:0; font-size: 18px;">Install App</h3>
        </div>
        <div class="install-content">
            <div class="install-card">
                <div class="install-hero">
                    <img src="app_icons/icon-512.png" alt="App Icon">
                    <div>
                        <h2>Install Vamsha Vruksha</h2>
                        <p>Add this app to your Android phone for a full-screen, fast experience (works offline after first load).</p>
                    </div>
                </div>
                <div class="install-actions">
                    <button id="install-app-btn" class="install-btn" disabled>Install on Android</button>
                    <button id="install-how-btn" class="btn btn-outline">How to install</button>
                </div>
                <div id="install-status" class="install-hint" style="margin-top: 12px;">
                    Checking install availability‚Ä¶
                </div>
            </div>
        </div>
    </div>

    <!-- Scripts -->
    <script src="https://balkan.app/js/FamilyTree.js"></script>
    <script src="app.js"></script>
    <script>
        // Sidebar toggle and close (expose closeSidebar for menu onclick)
        function toggleSidebar() {
            var sidebar = document.getElementById('sidebar');
            var backdrop = document.getElementById('sidebar-backdrop');
            if (!sidebar) return;
            sidebar.classList.toggle('open');
            if (backdrop) backdrop.classList.toggle('show', sidebar.classList.contains('open'));
        }
        function closeSidebar() {
            var sidebar = document.getElementById('sidebar');
            var backdrop = document.getElementById('sidebar-backdrop');
            if (sidebar) sidebar.classList.remove('open');
            if (backdrop) backdrop.classList.remove('show');
        }
        // Click/tap on backdrop closes sidebar (mobile overlay)
        (function() {
            var backdrop = document.getElementById('sidebar-backdrop');
            if (backdrop) backdrop.addEventListener('click', closeSidebar);
        })();
    </script>

</body>
</html>